\documentclass[10pt,a4paper]{IEEEtran}
\usepackage[latin1]{inputenc}
\usepackage[spanish,es-tabla]{babel}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{float}
\usepackage{hyperref}
\usepackage{subcaption} 
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage[usenames]{color}
\usepackage{booktabs}
\usepackage{caption}
\usepackage{mwe}
\usepackage{hyperref}

\renewcommand{\thetable}{\arabic{table}}
\author{Gatica, Isaias \\ Martin, Santiago \\ Saez, Lautaro Ándres \\ Vidman, Xavier Harry}
\title{Proyecto integrador DSP \\ Filtrado de ruido con transformada de wavelet}
\providecommand{\abs}[1]{\lvert#1\rvert}
\date{}

\begin{document}
\maketitle

\begin{abstract}
En el siguiente trabajo se estudiarán los conceptos de las funciones wavelets, transformada de wavelet, y cómo utilizarlos para filtrar ruido de señales unidimensionales y bidimensionales. En este informe se centrará el estudio en filtrado de imágenes. Para el filtrado de ruido se hará un análisis de multiresolución y un estudio de los umbrales más utilizados, con el fin de poder decidir qué umbral usar para la señal o imagen que se quiera estudiar. Como adelanto, el umbral es el parámetro que decide cómo se filtrarán los coeficientes que caracterizan a la imagen. Se describirá una implementación paso a paso de cómo realizar el filtrado de ruido, para luego poder utilizarlo en imágenes con ruido artificial y real. Luego, se podrá comparar con otros métodos de filtrado la eficiencia de utilizar wavelets para esta aplicación.
\end{abstract}


\section{Introducción}
Partiendo de una perspectiva histórica, se puede decir que la teoría de wavelets comenzó con los estudios de Alfred Haar en 1909. En ese entonces, la línea de pensamiento era puramente matemática, buscando como objetivo el dividir una función temporal en diferentes componentes de traslación y escalamiento. En su honor, se nombró a la primera wavelet con su nombre: \textit{Haar wavelet}.

Los estudios de Alfred Haar, seguido de trabajos de Dennis Gabor, que colaboró con la construcción de más tipos de wavelets y trabajó en aplicaciones similares, se retomaron en los años 80. La evolución de la teoría de wavelets dio un salto importante durante esta década, gracias a que Stephane Mallat estableció una relación entre los filtros utilizados en el procesamiento de señales y las bases ortonormales de las wavelets. A partir de esto, Mallat desarrolló lo que se conoce como \textbf{análisis de multiresolución}, concepto que se explicará en el informe. 


En 1988, Ingrid Daubechies publicó un conjunto de wavelets ortonormales que se convirtieron en el pilar de las aplicaciones wavelets.


En base al análisis de multiresolución, el estudio de la teoría de wavelets creció a tal punto de poder utilizarse para diversas aplicaciones. Las aplicaciones más importantes son la compresión de imágenes y el filtrado de ruido a través de la transformada wavelet. Otra aplicación importante es el poder identificar en qué momento se dan los picos de frecuencia de una señal. Con la transformada de wavelet esto es posible, ya que el análisis es temporal y frecuencial, de forma paulatina.


\section{Marco teórico}
Una \textit{wavelet} es una ``pequeña onda'' que tiene su energía concentrada en un período de tiempo determinado, son de duración definida e irregulares, lo que les permite 
adaptarse y converger de mejor manera a la señal que se quiere analizar.
Las familias de estas wavelet, también conocidas como ``wavelets madres", se definen como:
\begin{equation}
    \label{WM}
    \psi_{a,b}(t)= \frac{1}{\sqrt{a}} \psi \left( \frac{t-b}{a} \right) \quad a,b \in \mathbb{R} \quad ; a \not = 0. 
\end{equation}
Donde $a$ y $b$ son los parámetros de escala y traslación respectivamente. Se puede ver en la Fig.\ref{fig.a_b1} como trabajan los parámetros $a$ y $b$. El parámetro $b$, asociado a la traslación, hace que la wavelet recorra a la señal $x(t)$ a través del tiempo. Mientras que el parámetro $a$, permite controlar el ancho de la wavelet.

Por otro lado, la transformada de wavelet queda definida como \cite{CT}:

\begin{equation}
C_{f} (a,b) = \int_{-\infty}^{+\infty} x(t) \overline{\psi_{a,b} (t)} dt
\end{equation}

Donde $\psi_{a,b}(t)$ es la función que se utiliza para analizar a la señal $x(t)$ que se quiera estudiar. Realizando una analogía con Fourier, el trabajo que realiza $\psi_{a,b}(t)$, es el mismo que el de las exponenciales complejas $e^{- j \omega t}$. El resultado de esta transformada es una familia de coeficientes  $C_{f} (a,b)$ que representan la señal teniendo en cuenta la wavelet madre utilizada. Es notorio que el resultado es bidimensional ya que $a$ y $b$ son parámetros independientes. Donde $a$ está relacionado con la frecuencia que posee la señal y $b$ nos brinda información del momento temporal que se analiza. En la Fig.\ref{fig.a_b} se puede ver de mejor manera, donde el gráfico superior muestra cómo cambia la frecuencia de una señal en función de la traslación $b$, en específico en $b_0$. Y el gráfico inferior muestra el resultado de la transformada, evidenciando en el tiempo $b_0$ el cambio de frecuencia.

\begin{figure}[htb]
	\centering
	\includegraphics[width=.5\textwidth]{Fig/a_b}
	\caption{Traslación y escalamiento de una wavelet.}
	\label{fig.a_b1}
\end{figure}
\begin{figure}[H]
	\centering
	\includegraphics[width=.5\textwidth]{Fig/t_f}
	\caption{Representación del resultado de transformada wavelet en relación a los coeficientes de traslación y escala.}
	\label{fig.a_b}
\end{figure}

Por lo tanto, el uso de wavelets permite realizar un análisis paulatino en tiempo y frecuencia como se mencionó anteriormente. 
Cabe recalcar que existen diferentes tipos de wavelets madres, en la Fig.\ref{fig.wavelets_madres} se pueden ver las más utilizadas.

\begin{figure}[htb]
	\centering
	\includegraphics[width=.5\textwidth]{Fig/Wavelets}
	\caption{Tipos de wavelets más utilizadas.}
	\label{fig.wavelets_madres}
\end{figure}



En este informe se limita a estudiar el caso en el que $a=2$ y $b=1$, obteniendo la siguiente expresión:

\begin{equation}
\psi_{j,k}(t) = 2^{-j/2} \psi (2^{-j}t-k)
\end{equation}

Donde las funciones $\{\psi_{j,k}\}_{\{j,k\} \in \mathbb Z }$ forman una base ortonormal de $L^2(\mathbb R)$. Con el fin de explicar este requerimiento, es necesario explicar un concepto llamado \textbf{análisis multiresolución}.

\subsection{\textbf{Análisis multiresolución}}
Un análisis multiresolución para $L^{2}(\mathbb{R})$ consiste en una secuencia de subespacios cerrados de $L^{2}(\mathbb{R})$, $\{ V_{j} \}_{j \in \mathbb{Z} }$, y una función $\phi \in V_{0}$ tal que se cumplan las siguientes condiciones:

\begin{itemize}
\item[i.] Los espacios $V_{j}$ están anidados, es decir:
\begin{equation*}
... \subset V_{-1} \subset V_{0} \subset V_{1} ...
\end{equation*}
\item[ii.] $\overline{\cup _{j\in \mathbb Z}V_j} = L^2(\mathbb R)$ y $\cap_{j\in \mathbb Z} V_j = 
\{0\}$
\item[iii.] Para todo $j \in \mathbb{Z}$, $V_{j-1}=D(V_j)$
\item[iv.] $f \in V_0 \rightarrow T_kf \in V_o$, $\forall k \in \mathbb{Z}$
\item[v.] $\{T_k \phi \}_{k \in \mathbb{Z}}$ es una base ortonormal de $V_0$
\end{itemize} 


Por otro lado, se define a $W_j$ como el complemento ortogonal de $V_j$ en $V_{j-1}$, que permite plantear la siguiente relación:

\begin{equation}
\label{Central}
V_{j-1} = V_j \oplus W_j
\end{equation}

$W_j$ es llamado conjunto de \textbf{detalle} debido a que la proyección ortogonal de la señal en este espacio son los detalles, y $V_j$ espacio de \textbf{aproximación}, ya que la proyección ortogonal de la señal sobre este espacio son las aproximaciones. Con lo cual, se puede reescribir la eq.\ref{Central} como:

\begin{equation}
\label{NivApDet}
A_{j-1}(t) = A_j(t) + D_j(t) 
\end{equation} 

Donde $A_j(t)$ se define de la siguiente forma:

\begin{equation}
A_j(t)=\sum_{k \in \mathbb Z} \beta _{j,k} \phi _{j,k}(t)
\end{equation}

Donde:

\begin{equation}
\label{Beta}
\beta _{j,k}= <x(t), \phi _{j,k}(t)>= \int_\mathbb R x(t) \overline{\phi_{j,k}(t)} dt
\end{equation}

Estos coeficientes $\beta _{j,k}$ definen los promedios locales de la señal. Por otro lado, $D_j(t)$ se define a través de la siguiente expresión:

\begin{equation}
D_j(t)=\sum_{k \in \mathbb Z} \alpha _{j,k} \psi _{j,k}(t)
\end{equation}

Donde los coeficientes $\alpha _{j,k}$ se relacionan con la diferencia entre promedios locales sucesivos (fluctuaciones de la señal), y quedan definidos de la siguiente forma:

\begin{equation}
\label{Alfa}
\alpha _{j,k}= <x(t), \psi _{j,k}(t)>= \int_\mathbb R x(t) \overline{\psi_{j,k}(t})dt
\end{equation}
La función $\psi \in L^{2}(\mathbb{R})$, y $\{T_k \psi \}_{k \in \mathbb{Z}}$ son una base ortonormal de $W_0$

%Discutir si poner la proposicion 1
Para dar un cierre a la idea de multiresolución se profundiza en la eq.\ref{Central} que es el punto más fuerte de esta técnica. Se reescribe de la siguiente manera:

\begin{equation}
V_J = V_K \oplus W_K \oplus ... \oplus W_{J+1}, \: J<K
\label{eq.Vj}
\end{equation}

La eq.\ref{eq.Vj} expresa que es posible pasar de un nivel de resolución $J$ a cualquier nivel superior sumando los sucesivos detalles de los niveles inferiores. Es decir, la aproximación mejora a medida que el nivel $J$ decrece. También se observa que cualquier nivel de resolución $V_j$ se puede expresar como:

\begin{equation}
\label{NiveDet}
V_J = \sum_{j=J+1}^{+\infty}W_j
\end{equation}

Por lo tanto cualquier nivel es igual a la suma de sus infinitos detalles. Análogamente cualquier función puede ser expresada como una suma de infinitos detalles:

\begin{equation}
\label{NiveDet2}
L^2(\mathbb{R})= \oplus _{j=-\infty}^{+\infty} W_j
\end{equation}

A partir de las eq.\ref{NiveDet} y \ref{NiveDet2} se puede ver que:

\begin{equation}
L^2(\mathbb{R})=V_J \oplus (\oplus _{j=-\infty}^{J}W_j)
\end{equation}

Finalmente, como el espacio $V_j$ se relaciona con el espacio detalle $A_J(t)$ y el $W_j(t)$ con los espacios de detalles $D_j(t)$:

\begin{equation}
x(t) = A_J(t) + \sum_{j=-\infty}^{J}D_j(t)
\end{equation}

Por lo tanto, se define a cualquier señal $x(t)$ como la suma de una \textbf{aproximación}, que sería la parte más ``burda'' de la señal, con sus infinitos \textbf{detalles}, que serían ``toques finales''. Esto se observa en la Fig.\ref{Tree}, donde se utilizó una wavelet symmet 4 y 3 niveles de descomposición. En rojo la señal original, en azul la aproximación y en verde las tres señales de detalle correspondientes.
  
\begin{figure}[htb]
	\centering
	\includegraphics[width=.5\textwidth]{Fig/Tree}
	\caption{Descomposición de nivel 3 de una señal utilizando una wavelet sym4.}
	\label{Tree}
\end{figure}

A partir de esta idea, se ve que es factible aplicar la transformada de wavelet para eliminar el ruido de una señal. Por lo tanto, si se busca una forma de filtrar los coeficientes a partir de parámetros relacionados con el ruido de la señal, se podrían eliminar las componentes no deseadas. Luego, a la hora de reconstruir la señal, se obtendría una versión sin ruido. Estos parámetros son llamados \textbf{umbrales} y se definirán más adelante.


Teniendo en mente la idea del filtrado, y aún con el inconveniente de que el producto interno para calcular los coeficientes (eq.\ref{Beta} y \ref{Alfa}) requiere un alto costo computacional, se plantea una estrategia basada en un algoritmo que relacione las bases ortonormales de wavelets y los bancos de filtros \cite{CT}. Dicho algoritmo permite calcular los coeficientes $a^{j}$ y $d^{j}$ a partir de los coeficientes de aproximación de una escala anterior de resolución, es decir los $\alpha^{j-1}$, siendo estos los coeficientes que representan de manera perfecta la señal a analizar. Para llegar a esta relación se parte de la eq.\ref{NivApDet} donde:
%Explicar bancos de filtros o nombrarlo de otra forma

\begin{equation}
\label{Aj}
A_j(t)=\sum_{k \in \mathbb Z}  a^{j}_{k} \phi _{j,k}(t)
\end{equation} 
\begin{equation}
\label{Dj}
D_j(t)=\sum_{k \in \mathbb Z}  d^{j}_{k} \psi _{j,k}(t)
\end{equation} 
con
\begin{equation}
\label{ajk}
a^{j}_{k}= <A_{j}(t), \phi _{j,k}(t)>
\end{equation}
\begin{equation}
\label{ajk}
d^{j}_{k}= <A_{j}(t), \psi _{j,k}(t)>
\end{equation}

Si se desea obtener $ a^{j}_{k}\: y\: d^{j}_{k}$ a partir de $A_{j-1}$, se realiza el producto interno $A_{j-1}$ y la función de escala y wavelet.

%Poner esto del producto interno? o directamente decir que operando llegamos a las ultimas dos ecuaciones?

\begin{equation}
<A_{j-1}(t),\psi _{j,k}(t)>=<A_{j}(t)+D_{j},\psi _{j,k}(t)>
\end{equation}
\begin{equation*}
<A_{j-1}(t),\psi _{j,k}(t)>=<A_{j}(t),\psi _{j,k}(t)>+<D_{j}(t),\psi _{j,k}(t)>
\end{equation*}
\begin{equation*}
<A_{j-1}(t),\psi _{j,k}(t)>=0+d_{k}^{j}
\end{equation*}


\begin{equation}
<A_{j-1}(t),\phi _{j,k}(t)>=<A_{j}(t)+D_{j},\phi _{j,k}(t)>
\end{equation}
\begin{equation*}
<A_{j-1}(t),\phi _{j,k}(t)>=<A_{j}(t),\psi _{j,k}(t)>+<D_{j}(t),\psi _{j,k}(t)>
\end{equation*}
\begin{equation*}
<A_{j-1}(t),\phi _{j,k}(t)>=a_{k}^{j}+0
\end{equation*}

Debido a los espacios que pertenece cada una se tiene que $D_{j}$ es perpendicular a la función $\phi _{j,k}$ y $A_{j}$ es perpendicular a la función $\psi _{j,k}$, con lo cual el producto interno entre  esas funciones ortogonales es 0 \\
Como $A_{j-1}=\sum_{k \in \mathbb Z} a_{k}^{j-1} \phi_{j-1,k}(t)$:
\begin{equation}
a_{k}^{j}=<A_{j-1}(t),\phi _{j,k}(t)>=\left<\sum_{p \in \mathbb{Z}} a^{j-1}_p \phi_{j-1,p},\phi_{j,p}\right>
\end{equation}
\begin{equation*}
a_{k}^{j}=\sum_{p \in \mathbb{Z}} a^{j-1}_p <\phi_{j-1,p},\phi_{j,p}>
\end{equation*}

\begin{equation}
d_{k}^{j}=<A_{j-1}(t),\psi _{j,k}(t)>=\left<\sum_{p \in \mathbb{Z}} a^{j-1}_p \phi_{j-1,p},\psi_{j,p}\right>
\end{equation}
\begin{equation*}
d_{k}^{j}=\sum_{p \in \mathbb{Z}} a^{j-1}_p <\phi_{j-1,p},\psi_{j,p}>
\end{equation*}
Calculando los productos internos:
\begin{equation}
<\phi_{j-1,p},\phi_{j,p}>=\int_\mathbb{R} \phi_{j-1,p}(t)\overline{\phi_{j,p}}(t) dt
\end{equation}
\begin{equation*}
<\phi_{j-1,p},\phi_{j,p}>=\int_\mathbb{R}2^{-\frac{j}{2}}2^{-\frac{1}{2}} \phi(2^{-j+1}t-p)\overline{\phi}(2^{-j}t-k) dt
\end{equation*}
Haciendo cambio de variable $2^{-j}t-k=\frac{u}{2}$ y usando solo wavelets reales:
\begin{equation}
<\phi_{j-1,p},\phi_{j,p}>=\sqrt{2}\int_\mathbb{R} \phi(u-(p-2k))\frac{1}{2}\phi(\frac{u}{2})du
\end{equation}
Utilizando las siguientes ecuaciones:
\begin{equation}
\frac{1}{2}\phi(\frac{u}{2})=\sum_{n \in \mathbb{Z}} a_{n}\phi_{0,n}(u)
\end{equation}
\begin{equation}
\frac{1}{2}\psi(\frac{u}{2})=\sum_{n \in \mathbb{Z}} b_{n}\phi_{0,n}(u)
\end{equation}
Como $\psi(\frac{u}{2})$ y $\phi(\frac{u}{2})$ pertenecen al espacio $V_{0}$ pueden escribirse en la base $\{\phi_{0,n}\}_{n \in \mathbb{Z}}$.
Reemplazando lo anterior
\begin{equation}
<\phi_{j-1,p},\phi_{j,p}>=\sqrt{2}\int_\mathbb{R} \phi(u-(p-2k))\sum_{n \in \mathbb{Z}} a_{n}\phi_{0,n}(u)du
\end{equation}
\begin{equation*}
<\phi_{j-1,p},\phi_{j,p}>=\sqrt{2}\sum_{n \in \mathbb{Z}}a_{n}\int_\mathbb{R} \phi_{0,p-2k}(u)\phi_{0,n}(u)du
\end{equation*}
\begin{equation*}
<\phi_{j-1,p},\phi_{j,p}>=\sqrt{2}\sum_{n \in \mathbb{Z}}a_{n}< \phi_{0,p-2k},\phi_{0,n}>
\end{equation*}

Por analogía se obtiene:
\begin{equation*}
<\phi_{j-1,p},\psi_{j,p}>=\sqrt{2}\sum_{n \in \mathbb{Z}}b_{n}< \phi_{0,p-2k},\phi_{0,n}>
\end{equation*}
Como $\{ \phi_{0,n}\}_{n \in \mathbb{Z}}$ es una base ortonormal
\begin{equation}
<\phi_{j-1,p},\phi_{j,p}>=\sqrt{2}a_{p-2k}
\end{equation}

\begin{equation}
<\phi_{j-1,p},\psi_{j,p}>=\sqrt{2}b_{p-2k}
\end{equation}
Reemplazando con las ecuaciones anteriores 

\begin{equation}
a^{j}_{k}=\sum_{p \in \mathbb Z} a^{j-1}_{p}<\psi _{j-1,p}(t),\psi _{j,k}(t)>=\sum_{p \in \mathbb Z}a^{j-1}_{p}\sqrt{2} a_{p-2k}
\end{equation}

\begin{equation}
d^{j}_{k}=\sum_{p \in \mathbb Z} a^{j-1}_{p}<\psi _{j-1,p}(t),\phi _{j,k}(t)>=\sum_{p \in \mathbb Z}a^{j-1}_{p}\sqrt{2} b_{p-2k}
\end{equation}


Se observa que los coeficientes $a_{p-2k}$ y$b_{p-2k}$son productos internos de funciones ya conocidas, la función wavelet y su función de escala. Estos valores ya fueron calculados y se los asume como conocidos, por lo cual si se consideran como los coeficientes de filtros se puede definir a $LoD=\{[LoD]_{n}\}_{n \in \mathbb{Z}}$ y a $HiD=\{[Hid]_{n}\}_{n \in \mathbb{Z}}$ como el filtro pasabajos y un filtro pasaaltos respectivamente.


Por lo cual:

\begin{equation}
[LoD]_{n}=\sqrt{2}  a_{-n}
\end{equation}

\begin{equation}
[HiD]_{n}=\sqrt{2}  b_{-n}
\end{equation}

Se tiene esta caracterización de que los $a_{-n}$ son coeficientes de un filtro pasa bajo ya que son los encargados de conservar la forma de la señal es decir la aproximación  y los $b_{-n}$ como coeficientes de un filtro pasa alto ya que al ser los que conservan los detalles de la señal se asume que se encuentras en frecuencias altas.

Quedando entonces definidos los coeficientes en un nivel j como:

\begin{equation}
\label{afinal}
a^{j}_{k}=\sum_{p \in \mathbb Z} a^{j-1}_{p} [LoD]_{2k-p}
\end{equation}

\begin{equation}
\label{dfinal}
d^{j}_{k}=\sum_{p \in \mathbb Z} a^{j-1}_{p} [HiD]_{2k-p}
\end{equation}

Estos coeficientes presentan un aspecto muy similar a la suma de convolución entre el coeficiente del nivel anterior con el filtro correspondiente. Para que esta sea la convolución se introduce la operación de submuestreo, definida como:

\begin{equation}
\label{dec}
y=dec(x)\Leftrightarrow y_{n}=x_{2n} \forall n \in \mathbb Z
\end{equation}

usando las eq.\ref{afinal}, \ref{dfinal}, \ref{dec} y la convolución se llega a:

\begin{equation}
a^{j}=dec(a^{j-1}\ast LoD)
\end{equation}
\begin{equation}
d^{j}=dec(a^{j-1}\ast HiD)
\end{equation}

\begin{figure}[htb]
	\centering
	\includegraphics[width=.5\textwidth]{Fig/bancofiltros1D}
	\caption{Descomposición con banco de filtros para 1D.}
	\label{bancofiltros1D}
\end{figure}

%agregar la imagen de los bloques 
Lo que permite ver que cada señal se descompone en 2 señales, la de aproximación y detalle de la mitad de la dimension de la señal original.


Es posible demostrar que se puede realizar el proceso inverso y reconstruir la señal aproximada, de la misma manera en que se descompuso, la suma de señales convolucionadas con filtros pasabajos y pasaaltos, matemáticamente se puede ver en la siguiente expresión:


\begin{equation}
\label{recomp}
a^{j-1}_{k}=\sum_{p \in \mathbb Z} a^{j}_{p}[LoR]_{k-2p}+\sum_{p \in \mathbb Z} d^{j}_{p}[HoR]_{k-2p}
\end{equation}


Donde LoR y HoR son los filtros pasabajos y pasaaltos de reconstrucción.


Como se mencionó anteriormente, las señales $a^{j}$ y $d^{j}$ tienen una dimensión menor a la original que se desea reconstruir, por lo que es necesaria ``rellenarlas" para que tengan la dimensión correcta, el método de rellenado mas utilizado es el de inserción de ceros. 


%agregar imagen de bloque de reconstruccion.

Este desarrollo es posible extenderlo a dos dimensiones, permitiendo descomponer a las imágenes en cuatro señales diferentes que corresponden a la señal de aproximación y una descomposición de señales de detalles, una para detalles horizontales, verticales y diagonales. Lo mencionado se visualiza en la Fig.\ref{bancofiltros}.


\begin{figure}[H]
	\centering
	\includegraphics[width=.5\textwidth]{Fig/bancofiltros}
	\caption{Descomposición con banco de filtros para 2D.}
	\label{bancofiltros}
\end{figure}

Donde las matrices finales representan:
\begin{itemize}
\item LL representa la aproximacion.
\item LH representa los detalles verticales.
\item HL representa los detalles horizontales.
\item HH representa los detalles diagonales.
\end{itemize}

Y la reconstrucción, para el caso de 2D se visualiza en la Fig.\ref{bancofiltrosR}.

\begin{figure}[H]
	\centering
	\includegraphics[width=.5\textwidth]{Fig/bancofiltrosR}
	\caption{Recomposición con banco de filtros para 2D.}
	\label{bancofiltrosR}
\end{figure}

Donde los filtros LR =LoR y HR=HoR hacen referencia en los filtros pasabajos y pasaaltos descriptos en la eq.\ref{recomp}, y los bloques $2\uparrow$ representan el rellenado de la señal para obtener la dimensión correcta en la reconstrucción.

\subsection{\textbf{Umbrales}}
Como se mencionó anteriormente, es necesario determinar parámetros para realizar el filtrado de los coeficientes. Estos parámetros se denominan \textbf{umbrales}. Con el fin de seguir la nomenclatura utilizada en la bibliografía aplicada, a este método se lo denominará umbralización. La umbralización tiene dos características importantes a definir:
el tipo de umbralización y las distintas forma de calcular el valor del umbral. En la Fig.\ref{Umbral} se observan los tipos de umbralización \textbf{hard} y \textbf{soft}. El valor del umbral se encuentra 
notado con $\tau$. El tipo de umbralización \textbf{hard} anula todos los coeficientes que estén en el rango $[-\tau,\tau]$ y no modifica el resto. Lo mismo cumple el umbralizado \textbf{soft}
con la diferencia que los coeficientes fuera de este rango se ven reducidos linealmente. El tipo hard reproduce de 
mejor forma los picos y discontinuidades si se piensa a la señal en una dimensión, o por ejemplo, los bordes si se piensa en imágenes. Por otro lado, el tipo soft genera 
resultados más suaves en la aproximación de la señal, lo que es satisfactorio si no se busca un resultado discontinuo \cite{SH}. En las imágenes este método genera un efecto de 
difuminado justamente para suavizar el resultado final. \\ %Ver redacción y mejorar imagen

\begin{figure}[H]
	\centering
	\includegraphics[width=.5\textwidth]{Fig/Umbral}
	\caption{Tipos de umbralización más utilizados.}
	\label{Umbral}
\end{figure}

Ahora, para el cálculo del umbral $\tau$ existen distintos tipos de algoritmos. En este informe se estudiarán los  siguientes \cite{Th}:

\begin{itemize}
\item VisuShrink.
\item LevelShrink.
\item BayesShrink.
\item NormalShrink.
\item AWT(Adaptative Wavelet Treshholding).
\end{itemize}

$ \\ $

\subsubsection{\textbf{VisuShrink}} 

Este algoritmo, más conocido como umbral universal, está representado por la siguiente ecuación:

\begin{equation}
    \tau_{univ}=\sigma_n \sqrt{2ln(n)}
\end{equation}

Donde $\sigma$ es la varianza del ruido y $n$ es la dimensión de la señal. Esta ecuación se deduce a partir de que es sabido que el máximo valor de una señal que siga una distribución gaussiana con media cero y varianza $\sigma^2$ , $(x \thicksim N(0,\sigma^2))$ es menor que el valor $\sigma_n \sqrt{2log(n)}$, con una probabilidad 
que tiende a uno cuando $n$ tiende a infinito. Por lo tanto, este umbral iguala a cero los coeficientes que tengan una alta probabilidad de ser ruido puro \cite{Univ}. La simpleza del algoritmo lo hace de los más utilizados. Sin embargo, el solo tener en cuenta las características del ruido y la dimensión de la 
imagen, suele suavizar mucho la imagen. Esto se debe a que elimina muchos coeficientes de información útil al intentar 
eliminar el ruido presente.\\
Antes de continuar con el siguiente umbral, es necesario mencionar dos aspectos importantes, el primero de ellos es por qué los umbrales dependen de la dimension de la señal. Mientras mayor sea la dimensión, más aumentará la redundancia de la señal. Por lo tanto, hay menos información nueva que la información de base, y desde el punto de vista de wavelet, esto no genera que se aumenten los coeficientes importantes. Por consecuente, existe una relación proporcional entre los coeficientes de ruido y la dimensión de la señal, lo que implica la necesidad
de agregarlo al cálculo del umbral \cite{D}. \\
El segundo aspecto de importancia es que para la estimación de la varianza de ruido de la imágenes, se utilizan los coeficientes de mayor frecuencia que son los que presentan mayor energía de ruido. Estos coeficientes quedan representados en las matrices de detalle diagonal, ya que como se mostró en la Fig.\ref{bancofiltros}  se puede ver que la matriz de detalle diagonal se forma luego de filtrar dos veces la señal con un filtro pasa alto \cite{Di}.

%agregar imagen de que la diagonal es una weea.
$ \\ $

\subsubsection{\textbf{LevelShrink}}
este umbral depende de la escala de nivel, a diferencia de VisuShrink, que aplica el mismo umbral a cada nivel de descomposición. Su expresión es la siguiente:

\begin{equation}
    \tau_{level}=\sigma_n \sqrt{2ln(n)} 2^{-(J-j)/2}
\end{equation}
Donde $J$ es el número total de niveles de descomposición y $j$ el nivel correspondiente. Si bien esto genera un umbral que se adapta de mejor manera, sigue sin tener en cuenta los detalles de la señal a analizar.

$ \\ $

\subsubsection{\textbf{BayesShrink}}
la base de este umbral es minimizar la inferencia bayesiana. Sus ecuaciones son:
\begin{equation}
     \tau_{bayes} = \left\{
	       \begin{array}{ll}
		 \sigma_n^2/\sigma_s      & \mathrm{si\ } \sigma_n^2 < \sigma_y^2 \\
		 max(|y_i|) & \mathrm{si\ } \sigma_n^2 \geq \sigma_y^2 
	       \end{array}
	     \right.
\end{equation}
Donde $\sigma_n^2$ es la varianza del ruido, $\sigma_y^2$ es la varianza de la señal original y $\sigma_s$ es la varianza de la señal pura que se estima con la siguiente ecuación:

\begin{equation}
\sigma_{sk}=\sqrt{max\left(\left(\frac{1}{size(H_k)}\sum_{y_i \in H_k}y_i^2\right) - \sigma_n^2,0\right)}
\end{equation}

Donde $H_k$ es la matriz de detalle a analizar. Este algoritmo tiene como ventaja respecto a los anteriores que utiliza información de la señal a analizar pero es necesario conocer información de la imagen original (sin ruido).

$ \\ $

\subsubsection{\textbf{NormalShrink}}
este algoritmo suple la desventaja de BayesShrink ya que no se necesita información de la señal sin ruido y presenta todas las ventajas incorporadas de utilizar información de la señal a analizar. Se lo define como:
\begin{equation}
\tau_{normal} = \frac{\beta_k \sigma_n^2}{\sigma_{o}}
\end{equation}
Donde:
\begin{equation}
\beta_k=\sqrt{\frac{ln(size(H_k))}{J}}
\end{equation}
Y $\sigma_o$ es el desvío estándar de la señal que se quiere filtrar.

$ \\ $

\subsubsection{\textbf{AWT(Adaptative Wavelet Treshholding)}}
por último, se presenta el algoritmo AWT el cual depende de la media aritmética y de la media geométrica de los coeficientes de la señal en cada nivel de análisis. Se lo define como:
\begin{equation}
\tau_{AWT}=c\sigma_n - |AM-GM|
\end{equation}
Donde $AM$ es la media aritmética, $GM$ es la media geométrica y $c=2^{J-j}$.

\subsection{Estadísticos}
Con el fin de poder comparar los resultados se definen los siguientes estadísticos:
\begin{itemize}
\item MSE(mean square error) definido por
\begin{equation}
MSE=\frac{1}{n m} \sum_{i=0}^{m-1}\sum_{j=0}^{n-1}[I(i,j)-K(i,j)]^{2}
\end{equation}
\item PSNR(Peak Signal to Noise Ratio) definido mediante la ecuación
\begin{equation}
PSNR= 20  log(\max{I}) - 10 log (MSE)
\end{equation}
\item SSIM(structural similarity) que se define por 
\begin{equation}
SSIM(I,K) = \frac{(2\mu_I \mu_K + c_1)(2\sigma_{IK} + c_2)}{(\mu_I^2 + \mu_K^2 + c_1)(\sigma_I^2 + \sigma_K^2 + c_2)}
\end{equation}
\end{itemize}
Donde $n$ y $m$ son las dimensiones de la imagen, $I$ es la imagen original sin ruido y $K$ es la imagen filtrada. Para el SSIM $\mu_I$ es la media de la imagen original y $\mu_K$ es la media de la imagen a comparar. De manera analóga para $\sigma_I$ y $\sigma_K$. El valor de 
$\sigma_{IK}$ es la covarianza y los valores $c_1$ y $c_2$ son constantes.

\section{Implementación}
Para llevar a cabo el filtrado de ruido en imágenes es necesario realizar los siguiente pasos:

\begin{itemize}
\item[1)] Calcular el nivel adecuado de descomposición según la wavelet elegida, y la dimensión de la imagen. Si bien se puede elegir un nivel arbitrario de descomposición, aumentarlo por encima del nivel óptimo no mejora el resultado. Esto solo produce un filtrado de la información útil de la imagen, suavizando los detalles.
\item[2)] Realizar los siguientes pasos:

\begin{itemize}
\label{asd}
\item[i.] Descomponer la imagen en sus matrices de detalle (horizontal,vertical y diagonal).
\item[ii.] Calcular el desvío estándar del ruido a partir de la matriz de detalle diagonal para cada nivel.

\item[iii.] Filtrar los coeficientes de la matrices de detalle obtenidas en el paso i., variando alguno de los siguientes parámetros:
	\begin{itemize}
	\item Tipo de umbralización : hard o soft.
	\item Algoritmos de umbralización. 
	\item Cantidad de niveles de descomposición.
	\item Tipo de wavelet.
	\end{itemize}
\end{itemize}

\item[3)] Reconstruir la imagen a partir de los coeficientes de detalle filtrados en los pasos previos y la matriz de aproximación.
\end{itemize}

\section{Resultados}
A continuación, se presentan los resultados obtenidos en las imágenes de prueba, mostradas en la Fig.\ref{fig-imagenes-prueba}. Todas se modificaron con un ruido gaussiano de $\sigma=0.3$. (Las imágenes reales se encuentran en el anexo VI-A)

\begin{figure}
        \centering
        \begin{subfigure}[H]{0.4\textwidth}
            \centering
            \includegraphics[width=\textwidth]{Fig/Lenna}
            \caption[Lenna.]%
           {{\small Lenna.}}    
            \label{Lenna}
        \end{subfigure}
     %   \hfill
        \begin{subfigure}[H]{0.4\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{Fig/House}
            \caption[]%
            {{\small House.}}    
            \label{House}
        \end{subfigure}
        \vskip\baselineskip
        \begin{subfigure}[H]{0.4\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{Fig/Wave}
            \caption[]%
            {{\small Wave.}}    
            \label{Wave}
        \end{subfigure}
 
        \caption[ The average and standard deviation of critical parameters ]
        {\small Imágenes de prueba escogidas.} 
        \label{fig-imagenes-prueba}
\end{figure}

Luego de pruebas con diferentes wavelet, algoritmos de umbralización y variando la cantidad de niveles, se llegó a que el mejor resultado visual se obtuvo para:

\begin{itemize}
\item Wavelet = Sym8.
\item Umbral = NormalShrink soft.
\item Cantidad de niveles = 6.
\end{itemize}

Obteniéndose las imágenes filtradas y reconstruidas presentadas en la Fig.\ref{fig-imagenes-filtradas}.
%agregar imagenes filtradas.
\begin{figure}
        \centering
        \begin{subfigure}[H]{0.4\textwidth}
            \centering
            \includegraphics[width=\textwidth]{Fig/6_normal_soft_sym8_Lenna}
            \caption[Lenna.]%
           {{\small Lenna.}}    
            \label{Lenna}
        \end{subfigure}
     %   \hfill
        \begin{subfigure}[H]{0.4\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{Fig/6_normal_soft_sym8_House}
            \caption[]%
            {{\small House.}}    
            \label{House}
        \end{subfigure}
        \vskip\baselineskip
        \begin{subfigure}[H]{0.4\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{Fig/6_normal_soft_sym8_Wave}
            \caption[]%
            {{\small Wave.}}    
            \label{Wave}
        \end{subfigure}
 
        \caption[ The average and standard deviation of critical parameters ]
        {\small Imágenes filtradas.} 
        \label{fig-imagenes-filtradas}
\end{figure}

Para corroborar este resultado, se presentan las tablas comparativas de las distintas combinaciones de parámetros descritos en la sección \ref{asd} y sus imágenes asociadas. Dichos resultados se organizan de la siguiente manera:
\begin{itemize}
\item[IV-A] Resultados obtenidos al variar la cantidad de niveles de descomposición.
\item[IV-B] Resultados obtenidos para los dos tipos de umbralización.
\item[IV-C] Resultados obtenidos para los distintos algoritmos de umbralización.
\item[IV-D] Resultados obtenidos para cada tipo de Wavelet.
\end{itemize}
Los estadísticos que se utilizaron para comparar son el PSNR y el SSIM. El PSNR define la relación entre la máxima energía posible de una señal y el ruido que la afecta. Mientras menor es su valor, mayor es la cantidad de ruido en la imagen. Por otra parte, el SSIM mide la similitud entre dos imágenes. El resultado varía entre $0$ y $1$, donde SSIM = 1 indica que las imágenes son iguales. La ventaja de este estadístico recae en que los resultados coinciden con la percepción del ojo humano, lo que no sucede con el PSNR.


\subsection{Resultados obtenidos al variar la cantidad de niveles de descomposición.}
En esta sección se observan los resultados variando la cantidad de niveles de descomposición teniendo fijo la wavelet sym8, el tipo de umbralización soft y el algoritmo de umbralización es el NormalShrink.
\begin{table}[H]
\centering 
\begin{tabular}{lrrrrr}
\toprule
{imagen\textbackslash niveles} &  Sin filtrar &      1 &      2 &      4 &      6 \\
\midrule
Lenna &  17.65 &  23.92 &  \bf{27.03} &  22.29 &  22.29 \\
House &  19.87 &  22.90 &  \bf{25.58} &  24.57 &  23.51 \\
Wave &  18.63 &  23.34 &  \bf{26.70} &  24.71 &  24.65 \\
\bottomrule
\end{tabular}
\label{tabla-levels}
\caption{Valor de PSNR obtenido.}
\end{table}

\begin{figure}[H]
\centering
\includegraphics[width=0.53\textwidth]{Fig/Imgs/Levels}
\label{grafico-levels}
\caption{Grafico asociado a la Tab.1.}
\end{figure}


\begin{table}[H]
\centering 
\begin{tabular}{lrrrrr}
\toprule
{imagen\textbackslash niveles} &  Sin filtrar &      1 &      2 &      4 &      6 \\
\midrule
Lenna &  0.518 &  0.742 &  \bf{0.856} &  0.847 &  0.808 \\
House &  0.620 &  0.806 &  \bf{0.882} &  0.839 &  0.814 \\
Wave &  0.586 &  0.761 &  \bf{0.839} &  0.820 &  0.803 \\
\bottomrule
\end{tabular}
\label{tabla-levels-SSIM}
\caption{Valor de SSIM obtenido.}
\end{table}

\begin{figure}[H]
        \centering
        \begin{subfigure}[H]{0.22\textwidth}
            \centering
            \includegraphics[width=\textwidth]{Fig/Levels/1_normal_soft_sym8_Lenna}
            \caption[Lenna.]%
           {{\small Nivel 1.}}    
            \label{Lenna}
        \end{subfigure}
     %   \hfill
        \begin{subfigure}[H]{0.22\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{Fig/Levels/2_normal_soft_sym8_Lenna}
            \caption[]%
            {{\small Nivel 2.}}    
            \label{House}
        \end{subfigure}
        \vskip\baselineskip
        \begin{subfigure}[H]{0.22\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{Fig/Levels/4_normal_soft_sym8_Lenna}
            \caption[]%
            {{\small Nivel 4.}}    
            \label{Wave}
        \end{subfigure}
 		\begin{subfigure}[H]{0.22\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{Fig/Levels/6_normal_soft_sym8_Lenna}
            \caption[]%
            {{\small Nivel 6.}}    
            \label{Wave}
        \end{subfigure}
        \caption[ The average and standard deviation of critical parameters ]
        {\small Imágenes filtradas por nivel. } 
        \label{fig-imagenes-filtradas-nivel}
\end{figure}

A partir de los estadísticos vemos que el nivel 2 brinda mejores resultados numéricos. Sin embargo, si vemos las imágenes el nivel 6 presenta una mejora visual en cuanto al ruido presente.



\subsection{Resultados obtenidos para los dos tipos de umbralización.}
En esta sección se observan los resultados variando el tipo de umbralización teniendo fijo la wavelet sym8, el algoritmo de umbralización es el NormalShrink y la cantidad de niveles de descomposición igual a 2.
\begin{table}[H]
\centering 
\begin{tabular}{lrrr}
\toprule
{imagen\textbackslash método } &  Sin filtrar &   soft &   hard \\
\midrule
Lenna &  17.65 &  \bf{27.03} &  21.41 \\
House &  19.87 &  \bf{25.58} &  20.20 \\
Wave &  18.63 &  \bf{26.70} &  20.85 \\
\bottomrule
\end{tabular}
\label{tabla-modos}
\caption{Valore PSNR obtenido.}
\end{table}
\begin{figure}[H]
\centering
\includegraphics[width=0.53\textwidth]{Fig/Imgs/mode}
\label{grafico-levels}
\caption{Grafico asociado a la Tab.3.}
\end{figure}

\begin{table}[H]
\centering 
\begin{tabular}{lrrr}
\toprule
{imagen\textbackslash método } &  Sin filtrar &   soft &   hard \\
\midrule
Lenna &  0.518 &  \bf{0.856} &  0.757 \\
House &  0.620 &  \bf{0.882} &  0.789 \\
Wave &  0.586 &  \bf{0.839} &  0.755 \\
\bottomrule
\end{tabular}
\label{tabla-modos-SSIM}
\caption{Valor de SSIM obtenido.}
\end{table}
\begin{figure}[H]
        \centering
        \begin{subfigure}[H]{0.24\textwidth}
            \centering
            \includegraphics[width=\textwidth]{Fig/Modes/2_normal_soft_sym8_House}
            \caption[Lenna.]%
           {{\small Imagen filtrada soft.}}    
            \label{Lenna}
        \end{subfigure}
     %   \hfill
        \begin{subfigure}[H]{0.24\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{Fig/Modes/2_normal_hard_sym8_House}
            \caption[]%
            {{\small Imagen filtrada hard.}}    
            \label{House}
        \end{subfigure}
       \vskip\baselineskip
        \label{fig-imagenes-filtradas-modes}
        \caption[ The average and standard deviation of critical parameters ]
         {\small Imágenes filtradas con los métodos soft y hard. } 
\end{figure}

Si analizamos la imagen resultante al utilizar el tipo de umbralización Hard, vemos que esta pierde intensidad de color en los píxeles. Esto se debe a las zonas discontinuas que presenta (fig. \ref{}). En cambio el tipo Soft suaviza de forma mas suave generando una perdida menor de intesidad, esto también se ve reflejado en los mejores resultados de los estadísticos.

\subsection{Resultados obtenidos para los distintos algoritmos de umbralización.}
En esta sección se observan los resultados variando los algoritmos de umbralización teniendo fijo la cantidad de niveles de descomposición en 2, la wavelet que se utiliza es la sym8, y el tipo de umbralización soft.
\begin{table}[H]
\centering 
\begin{tabular}{lrrrrrr}
\toprule
{} &  Sin filtrar &  universal &  bayes &  level &  normal &    awt \\
\midrule
Lenna &  17.65 &      25.86 &  25.71 &  25.40 &   \bf{27.03} &  25.24 \\
House &  19.87 &      22.91 &  23.32 &  23.19 &   \bf{25.58} &  23.41 \\
Wave &  18.63 &      26.74 &  26.70 &  26.86 &   \bf{26.70} &  25.56 \\
\bottomrule
\end{tabular}
\label{tabla-umbrales}
\caption{Valor de PSNR obtenido.}
\end{table}
\begin{figure}[H]
\centering
\includegraphics[width=0.53\textwidth]{Fig/Imgs/umbral}
\label{grafico-levels}
\caption{Grafico asociado a la Tab.5.}
\end{figure}

\begin{table}[H]
\centering 
\begin{tabular}{lrrrrrr}
\toprule
{} &  Sin filtrar &  universal &  bayes &  level &  normal &    awt \\
\midrule
Lenna &  0.518 &   0.848 &  0.847 &  0.849 &  \bf{0.856} &  0.838 \\
House &  0.620 &   0.851 &  0.850 &  0.857 &  \bf{0.882} &  0.849 \\
Wave &  0.586 &   0.830 &  0.829 &  0.833 &  \bf{0.839} &  0.823 \\
\bottomrule
\end{tabular}
\label{tabla-umbrales-SSIM}
\caption{Valor de SSIM obtenido.}
\end{table}

\begin{figure}[H]
        \centering
        \begin{subfigure}[H]{0.22\textwidth}
            \centering
            \includegraphics[width=\textwidth]{Fig/Thr/2_universal_soft_sym8_Lenna}
            \caption[Lenna.]%
           {{\small Universal.}}    
            \label{Lenna}
        \end{subfigure}
     %   \hfill
        \begin{subfigure}[H]{0.22\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{Fig/Thr/2_bayes_soft_sym8_Lenna}
            \caption[]%
            {{\small Bayes.}}    
            \label{House}
        \end{subfigure}
        \vskip\baselineskip
        \begin{subfigure}[H]{0.22\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{Fig/Thr/2_level_soft_sym8_Lenna}
            \caption[]%
            {{\small Level.}}    
            \label{Wave}
        \end{subfigure}
 		\begin{subfigure}[H]{0.22\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{Fig/Thr/2_normal_soft_sym8_Lenna}
            \caption[]%
            {{\small Normal.}}    
            \label{Wave}
        \end{subfigure}
        \begin{subfigure}[H]{0.22\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{Fig/Thr/2_awt_soft_sym8_Lenna}
            \caption[]%
            {{\small AWT.}}    
            \label{Wave}
        \end{subfigure}      
        \caption[ The average and standard deviation of critical parameters ]
        {\small Imágenes filtradas con distintos algoritmos de umbralización. } 
        \label{fig-imagenes-filtradas-thr}
\end{figure}

\subsection{Resultados obtenidos para cada tipo de Wavelet}
En esta sección se observan los resultados variando el tipo de wavelet utilizada, teniendo fijo la 
la cantidad de niveles de descomposición igual a 2, el algoritmo de umbralización NormalShrink y el tipo soft
\begin{table}[H]
\centering 
\begin{tabular}{lrrrr}
\toprule
{imagen\textbackslash wavelet} &  Sin filtrar &   haar &    db4 &   sym8 \\
\midrule
Lenna &  17.65 &  23.44 & 25.19 &  \bf{27.03} \\
House &  19.87 &  \bf{26.38} &  24.78 &  25.58 \\
Wave &  18.63 &  24.67 &  \bf{26.87} &  26.70 \\
\bottomrule
\end{tabular}

\caption{Valor de PSNR obtenido.}
\label{tabla-wavelets}
\end{table}


\begin{figure}[H]
\centering
\includegraphics[width=0.53\textwidth]{Fig/Imgs/wavelet}
\label{grafico-wavelet}
\caption{Grafico asociado a la Tab.7.}
\end{figure}

\begin{table}[H]
\centering 
\begin{tabular}{lrrrr}
\toprule
{imagen\textbackslash wavelet} &  Sin filtrar &   haar &    db4 &   sym8 \\
\midrule
Lenna &  0.518 &  0.819 &  0.853 &  \bf{0.856} \\
House &  0.620 &  0.848 &  0.875 &  \bf{0.882} \\
Wave &  0.586 &  0.805 &  0.836 &  \bf{0.839} \\
\bottomrule
\end{tabular}
\caption{SSIM utilizando dos niveles de descomposición,umbral normalshrink, método soft.}
\label{tabla-wavelets-SSIM}
\end{table}
\begin{figure}[H]
        \centering
        \begin{subfigure}[H]{0.2\textwidth}
            \centering
            \includegraphics[width=\textwidth]{Fig/Wav/Haar}
            \caption[Lenna.]%
           {{\small Wavelet haar.}}    
            \label{Lenna}
        \end{subfigure}
     %   \hfill
        \begin{subfigure}[H]{0.215\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{Fig/Wav/db4}
            \caption[]%
            {{\small Wavelet db4.}}    
            \label{House}
        \end{subfigure}
        \begin{subfigure}[H]{0.2\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{Fig/Wav/Sym8}
            \caption[]%
            {{\small Wavelet sym8.}}    
            \label{House}
        \end{subfigure}
       \vskip\baselineskip
        \label{fig-imagenes-filtradas-modes}
        \caption[ The average and standard deviation of critical parameters ]
         {\small Imágenes filtradas con distintas wavelet,utilizando dos niveles de descomposición,umbral normalshrink, método soft.} 
\end{figure}
%parrafo haciendo referencia porque los mejores parametros son los que se dijeron antes
Los resultados no presentan mucha discrepancia entre si pero se observa que la wavelet haar al ser recta no puede representar bien superficies curvas, pero si lo hace de buena en imágenes que presentan bordes rectos, como en el caso de la casa. Esto queda reflejado en la fig.17 donde el PSNR es mayor para la imagen HOUSE.
\subsection{Comparación con otros métodos}
En esta sub-sección comparamos el filtrado de wavelet con dos filtros ya implementados para la supresión de ruido.

\begin{figure}[H]
        \centering
        \begin{subfigure}[H]{0.35\textwidth}
            \centering
            \includegraphics[width=\textwidth]{Fig/comparacion/wavelet_House}
            \caption[Lenna.]%
           {{\small Filtro de wavelet.}}    
            \label{filtro de wavelet}
        \end{subfigure}
     %   \hfill
        \begin{subfigure}[H]{0.35\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{Fig/comparacion/wiener_House}
            \caption[]%
            {{\small Filtro de Wiener.}}    
            \label{filtro de wiener}
        \end{subfigure}
        \begin{subfigure}[H]{0.35\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{Fig/comparacion/gaussian_House}
            \caption[]%
            {{\small Filtro gaussiano.}}    
            \label{filtro gaussiano}
        \end{subfigure}
       \vskip\baselineskip
        
        \caption[ The average and standard deviation of critical parameters ]
         {\small House filtrada con los distintos metodos.}
         \label{fig-comp-metodos} 
\end{figure}
\begin{table}[H]
\centering 
\begin{tabular}{lrrrr}
\toprule
{} &  Sin filtrar &  wavelet &  wiener &  gaussian \\
\midrule
Lenna &  23.10 &    23.83 &   \bf{26.30} &     26.14 \\
House &  24.80 &    25.07 &   \bf{28.28} &     27.99 \\
Wave &  24.21 &    24.33 &   \bf{27.00} &     26.86 \\
\bottomrule
\end{tabular}
\label{tabla-comparacion}
\caption{PSNR para los distintos métodos de filtrado.}
\end{table}
\begin{table}[H]
\centering 
\begin{tabular}{lrrrr}
\toprule
{} &  Sin filtrar &  wavelet &  wiener &  gaussian \\
\midrule
Lenna &  0.647 &  \bf{0.870} &  0.843 &  0.835 \\
House &  0.740 &  \bf{0.906} &  0.895 &  0.886 \\
Wave &  0.693 &  \bf{0.887} &  0.862 &  0.853 \\
\bottomrule
\end{tabular}
\caption{SSIM para los distintos métodos de filtrado.}
\label{tab.SSIM-filters}
\end{table}
Al comparar el PSNR se observa que el filtro de Wiener es mejor en los tres casos, pero al ver la Tab.\ref{tab.SSIM-filters}  se puede deducir que el filtrado con wavelet es mejor visualmente. Esto se debe, a como se menciono anteriormente, a que el SSIM es mejor estadístico para comparar imágenes.

\subsection{Aplicación a imágenes reales}

Por último, con el fin de verificar el funcionamiento del filtrado, utilizamos imágenes que presentan ruido real. En la figura \ref{} se observa una foto tomada en el año 1925 al príncipe de gales. Esta imagen presenta ruido debido a la tecnología de esa época. Por otro lado, en la imagen \ref{} se observa una tomografía de un cerebro, la cual presenta un ruido particular llamado ruido Rician. %Agregar referencia.

\begin{figure}[H]
        \centering
        \begin{subfigure}[H]{0.37\textwidth}
            \centering
            \includegraphics[width=\textwidth]{Fig/real/0}
            \caption[tom1sinfiltrar.]%
           {{\small Imagen sin filtrar.}}    
            \label{}
        \end{subfigure}
     %   \hfill
        \begin{subfigure}[H]{0.37\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{Fig/real/0-f}
            \caption[]%
            {{\small Imagen filtrada.}}    
            \label{}
        \end{subfigure}
       \vskip\baselineskip
        \label{tomografia}
        \caption[ The average and standard deviation of critical parameters ]
         {\small Resonancia magnética.} 
\end{figure}

\begin{figure}[H]
        \centering
        \begin{subfigure}[H]{0.37\textwidth}
            \centering
            \includegraphics[width=\textwidth]{Fig/real/1}
            \caption[tom1sinfiltrar.]%
           {{\small Imagen sin filtrar.}}    
            \label{}
        \end{subfigure}
     %   \hfill
        \begin{subfigure}[H]{0.37\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{Fig/real/1-f}
            \caption[]%
            {{\small Imagen filtrada.}}    
            \label{}
        \end{subfigure}
       \vskip\baselineskip
        \label{principe-gales}
        \caption[ The average and standard deviation of critical parameters ]
         {\small Foto del príncipe de Gales tomada en el año 1925.} 
\end{figure}

En los resultados se observa que el filtro es capaz de eliminar el ruido en imágenes reales de buena forma, siempre teniendo en cuenta el difuminado que se le agrega a raíz de ésto. En la imagen del príncipe se logró filtrar el ruido con mayor o menor intensidad según la cantidad de ruido presente en cada segmento de ella. Por otro lado, en la tomografía, el filtro fue capaz de dar buenos resultados para un ruido que presenta una distribución distinta a la distribución gaussiana. 



\section{Conclusiones}
A partir de los resultados obtenidos se puede concluir de manera general que el método de filtrado de ruido utilizando la transformada de wavelet es una herramienta útil. Viendo las Fig.\ref{fig-imagenes-prueba} y \ref{fig-imagenes-filtradas} se observa que el resultado de filtrar el ruido agregado artificialmente es aceptable. Si bien se presenta un difuminado que provoca pérdidas de detalles, esto es normal en la mayoría de métodos que utilizan umbrales, justamente por la necesidad de eliminar el ruido. Es importante recalcar la elección del nivel de descomposición y su relación con los estadísticos.
En las Tab.1 y 2, el nivel 2 es el que brinda mejores resultados numéricamente. Sin embargo, a la hora de ver las imágenes, el nivel 6 muestra menor cantidad de ruido que la imagen del nivel 2. Esta discrepancia se puede deber a que si bien la imagen del nivel 2 presenta ruido visible, la intensidad de los píxeles no varía tanto respecto a la original como si lo hace el nivel 6, lo que genera en la forma de calcular los estadísticos un mejor resultado. Por otro lado, la razón por la cual el nivel seis elimina mayor cantidad de ruido es que el nivel de descomposición aumenta y esto permite filtrar una mayor cantidad de coeficientes de detalles.
Se puede decir entonces, que se elimina una cantidad superior de ruido a costa de perder detalles. 
La wavelet utilizada sym8 es congruente que brinde mejores resultados ya que la forma de este tipo de onda se adapta de mejor manera a los detalles de la imagen por tener una forma más suave que la wavelet haar y db4. Por último, el algoritmo de umbralización normalShrink brinda un mejor filtrado debido a que utiliza información de la imagen y no solo de la varianza del ruido.


Además, es interesante analizar el resultado de la Tab.\ref{tabla-wavelets}. Para la wavelet haar la casa obtiene mejor PSNR, lo que es coherente por la forma de la haar y por los bordes rectos que presenta la casa. La forma discontinua y ``dura'' de esta wavelet no suaviza los bordes lo que permite que sobrevivan al filtrado. Sin embargo, los detalles de la imagen que no posean estas características se ven suprimidos, y genera una mayor discrepancia con la imagen original. Este resultado, es congruente con el de la SSIM (Tab.\ref{tabla-wavelets-SSIM}).


Ahora, analizando los resultados con los métodos de filtrado gaussiano y wiener, se ve en la Fig.\ref{fig-comp-metodos} que estos dos métodos no quitan tanto el ruido como el método de la transformada wavelet. Sin embargo, presentan un menor difuminado. Si se observa la Tab.\ref{tab.SSIM-filters}, los resultados de la transformada wavelet dan un mejor SSIM comparado con wiener y gaussiano, pero el PSNR da valores superiores para el filtro de Wiener. Concluyendo, la transformada de wavelet utilizada para filtrar ruido actúa de manera correcta al compararlo con métodos especializados en el filtrado de ruido.



Por último, cuando se implementó el filtrado en imágenes reales que contengan ruido, es decir que no se le agregó ruido de forma sintética, el resultado es aceptable. En la imagen del Príncipe de Gales es destacable que en comparación con las imágenes sintéticas esta no posee el mismo nivel de ruido en todas sus regiones y por lo tanto en las zonas donde es mayor el ruido vemos un mayor difuminado en la imagen resultante. Además, en el caso particular de la resonancia, ésta presenta un tipo de ruido particular llamado ruido Rician y aún así el filtro fue lo bastante robusto para adaptarse brindando un buen resultado.
\newpage

\section{Anexo}
\subsection{Imágenes reales}
\begin{figure}[H]
        \centering
        \begin{subfigure}[H]{0.3\textwidth}
            \centering
            \includegraphics[width=\textwidth]{Fig/Lennalimpia}
            \caption[Lenna.]%
           {{\small Lenna.}}    
            \label{Lenna-limpia}
        \end{subfigure}
     %   \hfill
        \begin{subfigure}[H]{0.3\textwidth}  
            \centering 
            \includegraphics[width=\textwidth]{Fig/houselimpia}
            \caption[]%
            {{\small House.}}    
            \label{House-limpia}
        \end{subfigure}
        \vskip\baselineskip
        \begin{subfigure}[H]{0.3\textwidth}   
            \centering 
            \includegraphics[width=\textwidth]{Fig/wavelimpia}
            \caption[]%
            {{\small Wave.}}    
            \label{Wave-limpia}
        \end{subfigure}
 
        \caption[ The average and standard deviation of critical parameters ]
        {\small Imágenes originales.}
\end{figure}





\begin{thebibliography}{0}
  \bibitem{CT}  Michel Misiti-Yves Misiti-Georges Oppenheim-Jean-Michel Poggi -``Wavelets and their Applications''
  \bibitem {SH} Cristóbal E. Vega González - ``Un metodo automático para la elección de la base de ondícula y la selección del umbral para la estimacion de señales''
  \bibitem{Th} José Antonio Guerrero Díaz de León - ``Conjuntos Completos de Filtros Para la Eliminación de Ruido''
en Imágenes
 \bibitem {Univ} Fei Xiaoa,Yungang Zhanga - ``A Comparative Study on Thresholding Methods in Waveletbased Image Denoising'' 
 \bibitem {D} Algortimos para reducción de ruido en señales - \href{http://catarina.udlap.mx/u_dl_a/tales/documentos/lem/hernandez_d_m/capitulo3.pdf}{http://catarina.udlap.mx}
   \bibitem {Di} D.Gnanadurai, and V.Sadasivam - ``An Efficient Adaptive Thresholding Technique for Wavelet Based Image Denoising''

  
\end{thebibliography}










\end{document}